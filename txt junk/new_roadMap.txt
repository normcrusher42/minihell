---

## ğŸ“… Week A â€” ğŸ§© Parser â†’ Command Struct

---

### ğŸ—“ Day 1
----------------------------------------------------------- âœ…
ğŸ«˜ **Beans â€” Build command model**

* ğŸ— Create files: `parsing/cmd_table.c`, `parsing/cmd_table.h`.
* âœï¸ Define:

  * `typedef enum e_redir { R_IN, R_OUT, R_APP, R_HEREDOC } t_redirtype;`
  * `typedef struct s_redir { t_redirtype type; char *arg; } t_redir;`
  * Extend `t_cmd` â†’ `char **argv; int argc; t_redir *redirs; int redir_count;`
* ğŸ” Scan token stream:

  * Split on `|` into command segments.
  * Within a segment, push words â†’ `argv`, operators+targets â†’ `redirs`.
  * Detect immediate syntax errors: pipe at start/end, `| |`, operator at end, redir without target.
* ğŸ§¼ Implement `free_cmd_table(t_cmd *cmds, int n)` to free argv, redirs, and array.

**âœ… Acceptance**

* Given tokens of `echo hi | wc -c`, you produce 2 `t_cmd` with correct `argv[]`.
* `cat >` yields error message + status 258 (syntax).

**ğŸ§ª Quick test**

* Manual: tokenize -> parse -> print structure (make a debug printer).

ğŸ¤ **Pika â€” Executor interface**

* ğŸ›  Create `exec/exec.h`, `exec/driver.c`.
* Define `int execute_job(t_cmd *cmds, int n, t_shell *sh);` (no body yet).
* Decide calling contract: executor owns no memory; it only reads and forks.

**âœ… Acceptance**

* Main can call `execute_job()` with mocked commands without crashing.
----------------------------------------------------------- âœ…

### ğŸ—“ Day 2

ğŸ«˜ **Beans â€” Redirections in parser**

* ğŸ§­ While parsing, support `<<`, `<`, `>`, `>>` (store `arg` as raw token, not opened yet).
* ğŸ§· Preserve original quote type flags for heredoc delimiter (quoted vs unquoted).
* ğŸ§ª Validate â€œtarget must be a WORDâ€ (not operator).

**âœ… Acceptance**

* `cat < in > out >> log` becomes redirs in order: IN\:in, OUT\:out, APP\:log.

ğŸ¤ **Pika â€” Builtin detection**

* ğŸ§© Add `builtins/builtins.h/.c`:

  * `int is_parent_builtin(const char*)` â†’ `cd`, `export`, `unset`, `exit`
  * `int is_child_builtin(const char*)` â†’ `echo`, `pwd`, `env`
  * `int dispatch_parent_builtin(t_cmd*, t_shell*)`
  * `int dispatch_child_builtin(t_cmd*, t_shell*)`
* Wire into `execute_job` (stub): if `n==1 && parent-builtin` â†’ call parent path, else fall through.

**âœ… Acceptance**

* For `cd /`, job runs parent path and returns an int status.

----------------------------------------------------------- âŒ / âœ… the leaks, Leen. THE DAMN LEAKS

### ğŸ—“ Day 3

ğŸ«˜ **Beans â€” Pipeline layout**

* ğŸ”— Confirm parse splits N commands by `|` and preserves order.
* ğŸ“¦ Add `print_cmd_table()` to dump `argv` and `redirs` for debugging (guarded by `#ifdef DEBUG`).

**âœ… Acceptance**

* Complex: `cat < in | grep a | wc -l >> out` prints 3 commands with accurate redirs.

ğŸ¤ **Pika â€” Exec loop skeleton**

* ğŸ” In `execute_job()`:

  * For now, **no pipes**: if `n==1`, route to `run_single_cmd()` that calls builtins/exec (to be implemented later).
  * Prepare placeholders for future: `run_pipeline()` signature, arrays for PIDs.

**âœ… Acceptance**

* Single command path compiles and returns a status without FD work.

----------------------------------------------------------- âœ… / âŒ awaiting Pika

### ğŸ—“ Day 4 (Integration)

ğŸ¤ **Both**

* ğŸ”Œ Main flow: tokenize â†’ parse â†’ (keep expansion placement TBD) â†’ `execute_job()`.
* ğŸ§± On parse error: print message, set `sh->last_exit_status=258`, skip exec.

**âœ… Acceptance**

* `| ls` yields parse error 258 and loop continues gracefully.
* Memory: `free_cmd_table()` called after each iteration.

---

## ğŸ“… Week B â€” âœ¨ Expander Placement & Quote Removal

---

### ğŸ—“ Day 5

ğŸ«˜ **Beans â€” Expansion stage (placement)**

* ğŸª„ Insert â€œexpand passâ€ **after parsing** and **before** execution:

  * For each commandâ€™s `argv[i]`: expand `$VAR` and `$?` unless token came from single quotes.
  * For redir **targets**: expand if appropriate; **heredoc delimiter** rules:

    * Quoted delimiter â†’ **no** expansion inside heredoc.
    * Unquoted delimiter â†’ expansion occurs in heredoc lines (implement next week).
* Keep your existing expand helpers; just apply them at node level.

**âœ… Acceptance**

* `echo "$USER"` expands; `echo '$USER'` does NOT.

ğŸ¤ **Pika â€” Quote stripping**

* âœ‚ After expansion, strip outer matching quotes from each `argv[i]` and redir **targets** (not heredoc content).
* Ensure empty result becomes `""` argument (not NULL).

**âœ… Acceptance**

* `echo "a b"` results in `argv[1]="a b"` (one argument).

---

### ğŸ—“ Day 6

ğŸ«˜ **Beans â€” Edge-expand tests**

* ğŸ§ª Cases:

  * `echo "$USER-$?"`
  * `grep "$HOME/Desktop"`
  * `echo '$HOME-$?'`
* Verify `argv` counts are correct after stripping quotes.

ğŸ¤ **Pika â€” Executor validation**

* ğŸ§ª Feed the executor with expanded/stripped nodes and confirm it sees the expected `argv[]`.

**âœ… Acceptance**

* Internal trace shows `argv` normalized, no stray quotes, no empty `argv[0]`.

---

### ğŸ—“ Day 7â€“8 (Integration & hardening)

ğŸ¤ **Both**

* ğŸš« Unclosed quotes: tokenizer should have flagged earlier; add guard to refuse execution with 258 if any token indicates â€œunclosedâ€.
* ğŸ§¼ Confirm freeing of any temporary expanded strings.

**âœ… Acceptance**

* Fuzz inputs with weird quotes; shell never segfaults, always returns to prompt.

---

## ğŸ“… Week C â€” âš™ï¸ Executor: Builtins & External Exec

---

### ğŸ—“ Day 9

ğŸ¤ **Pika â€” External execution**

* ğŸš€ Implement `run_single_cmd()`:

  * If not builtin: `find_command_path()`:

    * If `cmd` has `/`, try exec directly; else iterate `$PATH` (`:` split).
    * `ENOENT` â†’ 127 â€œcommand not foundâ€; `EACCES` â†’ 126.
  * `fork()` and `execve()`. Parent `waitpid`, propagate `WEXITSTATUS` or `128+sig`.
* ğŸ”§ In child: restore default SIGINT/SIGQUIT; in parent keep readline behavior.

**âœ… Acceptance**

* `foo` â†’ 127; `/bin/ls` â†’ 0; `/bin/ls nofile` â†’ non-zero.

ğŸ«˜ **Beans â€” Parser validation for argv\[0]**

* ğŸ§· Ensure that empty command (e.g., `"" | wc`) is still a command with empty `argv[0]` â†’ will fail in exec with 127, not crash parser.

---

### ğŸ—“ Day 10

ğŸ¤ **Pika â€” Builtins (all 7)**

* `echo [-n*]`, `pwd`, `env` (ignore args), `cd` (update `PWD`/`OLDPWD`), `export`, `unset`, `exit`.
* Parent/child split:

  * Parent-only when `n==1` & no pipeline (so `cd` persists).
  * Otherwise, child-builtins run in child.
* Return proper statuses:

  * `exit` with non-numeric â†’ print error, exit 2.
  * `exit` with too many args â†’ print error, **donâ€™t** exit, return 1.

**âœ… Acceptance**

* `cd /; pwd` shows new path.
* `exit 42` exits shell with code 42.

ğŸ«˜ **Beans â€” Parser sanity**

* ğŸ“Œ Ensure `export KEY=VAL` is parsed as one arg; forbid `=` operator recognition here.

---

### ğŸ—“ Day 11â€“12 (Integration)

ğŸ¤ **Both**

* ğŸ§ª Standalone redirs (no pipes yet):

  * `cat < in`
  * `echo hi > out`
  * `echo hi >> out`
* âœ… Exit codes bubble into `sh->last_exit_status`.

---

## ğŸ“… Week D â€” ğŸ”— Pipes + ğŸ“‚ Redirections

---

### ğŸ—“ Day 13

ğŸ«˜ **Beans â€” Pipeline runner**

* ğŸ”„ Implement `run_pipeline(t_cmd *cmds, int n, t_shell *sh)`:

  * Loop commands, `pipe()` for i < n-1.
  * Child i: set `dup2(prev_read, 0)` when i>0; set `dup2(pipe_write, 1)` when i\<n-1; close unused FDs.
  * Parent: close write asap; carry read to next; collect PIDs.

**âœ… Acceptance**

* `echo hi | wc -c` prints `3\n` (or `2\n` depending on echo behavior).

ğŸ¤ **Pika â€” Redirection applier**

* ğŸ“‚ `apply_redirections(t_cmd*, int *errcode)` called **in child before exec**:

  * `<` O\_RDONLY; `>` O\_WRONLY|O\_CREAT|O\_TRUNC 0644; `>>` O\_WRONLY|O\_CREAT|O\_APPEND 0644.
  * On open error: print error, set `*errcode`, `_exit(1 or 126)` as appropriate.

**âœ… Acceptance**

* `cat < nope` prints â€œNo such fileâ€ and child exits 1; pipeline continues appropriately.

---

### ğŸ—“ Day 14 (Integration)

ğŸ¤ **Both**

* ğŸ”€ Combine: pipelines + redirs + builtins.
* ğŸ“ Parent-builtin rule: only when single cmd & no pipes. Otherwise, run in child (state changes like `cd` wonâ€™t persistâ€”same as bash pipeline behavior).

**âœ… Acceptance**

* `cd / | pwd` prints `/` (in child) but parent `pwd` unchanged after.

---

### ğŸ—“ Day 15â€“16 (Matrix testing)

ğŸ§ª **Both**

* `cat < in | grep a > out`
* `echo a >> out && echo b >> out` *(run as two lines for now, `&&` not required)*
* Err cases:

  * `> out ls` â†’ 258 (syntax)
  * `cat | | wc` â†’ 258

**âœ… Acceptance**

* Last pipeline command status stored in `last_exit_status`.

---

## ğŸ“… Week E â€” ğŸ“œ Hereâ€‘Doc & ğŸ¯ Final Polishing

---

### ğŸ—“ Day 17

ğŸ«˜ **Beans â€” Hereâ€‘doc reader**

* ğŸ“ For each `R_HEREDOC`:

  * Before forking the pipeline, create a pipe; in parent, read lines until delimiter **exact** match (no trimming). Donâ€™t add to history.
  * If delimiter token was quoted â†’ **disable** expansion in the hereâ€‘doc body.
  * If unquoted â†’ mark this hereâ€‘doc as â€œexpandâ€ (Pika applies expansion per line).
  * Ctrlâ€‘C: abort hereâ€‘doc, set status 130, discard content.

**âœ… Acceptance**

* `cat <<EOF` collects lines; breaks on `EOF`; produces an FD ready for STDIN.

ğŸ¤ **Pika â€” Hereâ€‘doc integration**

* ğŸ”Œ Replace commandâ€™s STDIN with hereâ€‘doc read end **before** other `<` redirs (but remember â€œlast redir winsâ€ ruleâ€”so if later `< file` exists, it overrides).

**âœ… Acceptance**

* `cat <<EOF | wc -l` counts the lines entered.

---

### ğŸ—“ Day 18 (Hereâ€‘doc expansion & cleanup)

ğŸ«˜ **Beans**

* ğŸ§¹ Ensure all temporary hereâ€‘doc FDs closed in parent after forking children.

ğŸ¤ **Pika**

* âœ¨ If hereâ€‘doc is marked â€œexpandâ€, run `$VAR` and `$?` expansions per line before writing to the hereâ€‘doc pipe.

**âœ… Acceptance**

* With `export X=hi`:
  `cat <<EOF` + lines containing `$X` expand only when delimiter unquoted.

---

### ğŸ—“ Day 19â€“20 (Polish & Defense)

ğŸ¤ **Both**

* ğŸ•µï¸ Valgrind full suite (ignore readline leaks): no leaks in parser, expander, executor, heredoc.
* ğŸ”’ FD hygiene: no leaked pipes/opens on success/error.
* ğŸ“ Norm compliance: functions < 25 lines; split helpers where needed.
* ğŸ“œ Defense script covering:

  * Prompt/history, signals, quotes, `$`/`$?`, all 4 redirs, `|` pipelines, all 7 builtins, heredoc behavior, exit codes.

**âœ… Acceptance**

* Run defense script top-to-bottom with no crashes and expected outputs.

---

### Tiny â€œwhat to code todayâ€ reminder (copy/paste)

* Add file(s) ğŸ—‚ï¸
* Implement function(s) ğŸ”§
* Hook into flow ğŸ”Œ
* Free/close on all paths ğŸ§¹
* Minimal tests ğŸ§ª
* Mark status codes ğŸ¯
